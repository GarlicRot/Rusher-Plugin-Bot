name: Update Changelog  
  
on:  
  push:  
    branches:  
      - main  
    paths-ignore:  
      - "CHANGELOG.md"  
  workflow_dispatch:  
  
jobs:  
  update-changelog:  
    runs-on: ubuntu-latest  
    permissions:  
      contents: write  
    if: github.actor != 'github-actions[bot]'  
  
    steps:  
      - name: Checkout repository  
        uses: actions/checkout@v4  
        with:  
          fetch-depth: 0  
  
      - name: Set up Git  
        run: |  
          git config user.name "github-actions[bot]"  
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"  
  
      - name: Generate CHANGELOG.md  
        run: |  
          REPO_URL="https://github.com/${{ github.repository }}"  
  
          echo "# Changelog" > CHANGELOG.md  
          echo "" >> CHANGELOG.md  
          echo "This changelog is automatically generated from Git history." >> CHANGELOG.md  
          echo "" >> CHANGELOG.md  
          echo "---" >> CHANGELOG.md  
          echo "" >> CHANGELOG.md  
  
          # Newest â†’ Oldest (default log order)  
          git log \  
            --date=format:'%Y-%m-%d' \  
            --pretty=format:"### %ad%n%n- %s ([\`%h\`]($REPO_URL/commit/%H)) by **%an**%n%n" \  
            >> CHANGELOG.md  
  
      - name: Commit and push changelog  
        run: |  
          if git diff --quiet CHANGELOG.md; then  
            echo "No changes to changelog"  
            exit 0  
          fi  
  
          git add CHANGELOG.md  
          git commit -m "docs(changelog): update changelog"  
          git push
